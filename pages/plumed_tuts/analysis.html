<div class="columns">
   <h2> Analysis and choice of parameters </h2>
   <img src="pages/plumed_tuts/ala_phipsi.png" alt="2d slice of torsional angle data" class="floatright"/>
   <p>
      Sketch-map builds on the notion that in many cases the high-dimensional data
      that one is trying to represent with few parameters does actually contain 
      some genuinely high-dimensional features, which would interfere with the 
      dimensionality reduction procedure.
   </p>
   <h3>The histogram of pairwise distances</h3>
   <p>
      A first step is therefore to analyze the data in order to understand how 
      the samples are distributed in high-dimensional space. A cursory 
      examination of two-dimensional slices of the data set can be useful to
      achieve a superficial understanding of the structure of the data.
      Such a plot for the 12-alanine data shows that samples
      are gathered in seemingly Gaussian blobs, connected by a spiders web
      of less-populated transition states. <br/> 
      To better guide the choice of parameters one should perform a more quantitative
      analysis. To this aim, we can use the <span class='code'>dimdist</span> 
      utility to generate a histogram of the pairwise
      distances of samples, i.e. the probability distribution for two points picked
      from the sample at random to be at a given distance.
   </p>
  
   <div class="cbox">
   <div class="head" id="tut-dimdist-head" onclick="safe_toggle('tut-dimdist','tut-dimdist-head');">
      Running <span class="code">dimdist</span> [+-]
   </div>
   <div class="body" id="tut-dimdist" style="display: block;">
      <p>
      The <span class="code">dimdist</span> utility can be used to compute the distribution
      of pairwise distances within the high-dimensional data set. For this example, you should type
      </p>
      <div class="code" >
         dimdist -D 24 -P highd-dataset -pi 6.283185 -maxd 15 -nbin 300 -wbin 0.05 -lowmem &gt; highd-histo 
      </div>
      <p>
      Here the <span class="code">-D</span> options specifies the dimensionality, 
      <span class="code">-P</span> the location of the data file, <span class="code">-pi</span>
      indicates that in computing distances the coordinates have to be taken to have the 
      specified periodicity, and the other options control the range, bins and smoothening of
      the histogram. See --MANUAL-- for a more detailed description of the options which may
      apply to a different kind of data. <br/>
      Note that the computational expense of this analysis scales with the square of the number of 
      data points, so it can be quite time-consuming. It there are more than a few tens of thousands
      points, it is often sufficient to use a random subset of the samples.
      </p>
   </div>
   </div>
   <script type="text/javascript">safe_toggle('tut-dimdist','tut-dimdist-head');</script>
         
   <img src="pages/tuts/ala_histosolo.png" alt="Histogram of pairwise distances in D=24" class="floatleft"/>   
   <p> 
      The resulting histogram may be at first surprising. In most cases, as for the 12-ala
      data, one would observe a very low probability of  finding two points very close together. 
      This is a consequence of the high dimensionality: 
      taking two points from a high-D-dimensional Gaussian distribution it will be unlikely for 
      them to be at distances smaller than several standard deviations! As a rule of thumb, if 
      on all the d-dimensional slices of the original data the samples seems to have a Gaussian 
      distribution with standard deviation s, the distribution of distances in the full,
      D-dimensional description will be peaked at s*sqrt(D/d). In the example, the 2-d plot
      indicates a standard deviation of about 0.5, and the distribution shows a shoulder which 
      corresponds to these Gaussian correlations at about R=2. <br/>
      A second observation is that the overall distribution is likely to be strongly peaked at 
      rather large distances. In fact, in this case
      it can be shown that the long-range part of the distribution is very similar to a uniform
      distribution of samples, even if clearly the samples are not uniform at all!
      This is again a consequence of the quirks of working in high dimension: the "intrinsic" volume
      element grows so rapidly with distance that far-away points weight a lot in the histogram, 
      even though they carry very little information on the structure of the data set. 
   </p>
   <h3>Proximity in high dimension</h3>
   <p> 
      The idea behind sketch-map is to transform the distances in such a way that the (not-so-relevant)
      information contained in the short-range and long-range point-point distances is not considered,
      and the dimensionality reduction algorithm can focus on reproducing the intermediate distances,
      which carry information on the relative position of different stable conformations rather
      than on Gaussian fluctuations or on far-away relations which are dominated by the topology
      of the high-dimensional space rahter than on the specific features of the problem.  
   </p>
   <img src="pages/tuts/ala_histosigma.png" alt="n(r) and a superimposed s(R)" class="floatright"/>      
   <p>
      This is achieved by means of a sigmoid function which is applied to distances, <br/>
\[
  s_{\sigma,a,b}(r) = 1 - (1+ (2^{a/b}-1)(r/\sigma)^a)^{-b/a}
\]
      which is zero for x&rarr;0, one for x&rarr;&infin; and 1/2 for x=&sigma;. The a and be parameters
      define the rate at which s goes to zero and to one, respectively. The critical parameter to select
      is the switching distance &sigma;: points which are closer than &sigma; will be considered "close"
      and points which are farther apart will be considered "far". &sigma; should be placed somewhere 
      between the range of distances characteristic of Gaussian fluctuations (0-3 in this example)
      and the range dominated by the intrinsic high dimensionality (8 and larger in this example). 
      This leaves a range of &sigma; to be chosen in the 4-7 range. We choose here &sigma;=6, but 
      values not too far from this yield comparable results. <br/>
      Once &sigma; is chosen, one should select a and b. While the method is not very sensitive to these
      values, one should make sure that the step around R=&sigma; is not too sharp, and that at the same
      time distances within the Gaussian basins are mapped to zero. b should be chosen in such a way that
      s(x) approaches 1 by the time n(R) has become very small. If one observes that the final map projects
      some outliers very far away from anything else, it may help to reduce the value of b in high dimension,
      so that s(x) does not approach 1 too rapidly.
   </p>
   
   <div class="cbox">
   <div class="head" id="tut-sigma-head" onclick="safe_toggle('tut-sigma','tut-sigma-head');">
      Further examples of histogram and effective sigmoid functions [+-]
   </div>
   <div class="body" id="tut-sigma" style="display: block;">
      <p>
         -- PUT HERE HISTOGRAM/CHOSEN FUNCTION PLOTS FOR THE LIGAND BINDING, THE 3D EXAMPLE, AND FURTHER 
         DISCUSS THE RATIONALE --
      </p>
   </div>
   </div>
   <script type="text/javascript">safe_toggle('tut-sigma','tut-sigma-head');</script>
   
   
   <h3>Proximity in low dimension</h3>
   <p>
      One of the key-features of sketch-map is that also in low dimensions the similarity of points
      is not evaluated using Euclidean distances. Another sigmoid function is applied, so that the
      close&rarr;close/far&rarr;far mapping can be enforced. The &sigma; parameter in low dimension is 
      irrelevant, since using a value different from the one chosen in high dimension simply corresponds
      to a rigid scaling of the low-dimensional map. The high-dimension &sigma; should always be used.<br/>
      The a and b parameters do not need to be the same. If they are chosen to be equal to their
      high-dimension counterparts, sketch-map would ultimately try to match distances, since distances
      are transformed in low and high dimension in the same way. This may be desirable when the mapping
      is not too complex, e.g. when one knows already that high-dimensional points lie very close to a 
      hyperplane. <br/> 
      When this is not the case, it is useful to choose different values: the advantage is that one can
      better accommodate the counter-intuitive features of high-dimensional spaces in the low-dimensional
      projection. For instance, if D is the original dimension and d the dimension of the projection, 
      one can "equalize" the volume elements in the low and high-dimensional cases by choosing
      a<sub>d</sub>/d&asymp;a<sub>D</sub>/D. For the same reason, it is usually a good idea to choose 
      b<sub>d</sub> to be smaller than b<sub>D</sub>. As a rule of thumb, one or two are good values 
      to start experimenting for both a<sub>d</sub> and b<sub>d</sub>. <br/>
      In this example, we take a<sub>d</sub>=1 and b<sub>d</sub>=2.      
   </p>
   
</div>
